diff --git a/logrotate.c b/logrotate.c
index f7fde6b..5f94ff2 100644
--- a/logrotate.c
+++ b/logrotate.c
@@ -563,22 +563,20 @@ static int mailLog(char *logFile, char *mailCommand,
 static int mailLogWrapper(char *mailFilename, char *mailCommand,
 			  int logNum, struct logInfo *log)
 {
-    /* if the log is compressed (and we're not mailing a
-     * file whose compression has been delayed), we need
-     * to uncompress it */
-    if ((log->flags & LOG_FLAG_COMPRESS) &&
-	!((log->flags & LOG_FLAG_DELAYCOMPRESS) &&
-	  (log->flags & LOG_FLAG_MAILFIRST))) {
-	if (mailLog(mailFilename, mailCommand,
-		    log->uncompress_prog, log->logAddress,
-		    log->files[logNum]))
-	    return 1;
-    } else {
-	if (mailLog(mailFilename, mailCommand, NULL,
-		    log->logAddress, mailFilename))
-	    return 1;
-    }
-    return 0;
+	/* if the log is compressed (and we're not mailing a
+	* file whose compression has been delayed), we need
+	* to uncompress it */
+	if ((log->flags & LOG_FLAG_COMPRESS) && !(log->flags & LOG_FLAG_DELAYCOMPRESS)) {
+		if (mailLog(mailFilename, mailCommand,
+			log->uncompress_prog, log->logAddress,
+			(log->flags & LOG_FLAG_MAILFIRST) ? log->files[logNum] : mailFilename))
+			return 1;
+	} else {
+		if (mailLog(mailFilename, mailCommand, NULL,
+			log->logAddress, mailFilename))
+			return 1;
+	}
+	return 0;
 }
 
 static int copyTruncate(char *currLog, char *saveLog, struct stat *sb,
diff --git a/test/test b/test/test
index 5d0044c..538ea19 100755
--- a/test/test
+++ b/test/test
@@ -87,6 +87,9 @@ createlogs() {
 
 checkmail() {
     (echo -s $PWD/$1 user@myhost.org; echo $2) | diff -u - mail-out
+    if [ $? != 0 ]; then
+        exit 5
+    fi
 }
 
 checkoutput() {
@@ -324,7 +327,7 @@ test.log 0
 scriptout 0 foo
 EOF
 
-checkmail test.log first
+checkmail test.log.2.gz first
 
 # check rotation into a directory given as a relative pathname
 cleanup 12
